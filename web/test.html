<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>WebSocket Test</title>
</head>

<body>
  <h2>WebSocket Chat Test</h2>

  <label>User ID: <input type="text" id="user_id" value="user1"></label><br>
  <label>Token: <input type="text" id="token" style="width: 800px;" value="valid HS256 token with user_id"></label><br>
  <label>To (recipient): <input type="text" id="to" value="user2"></label><br>
  <label>Message: <input type="text" id="message" value="Hello!"></label><br>
  <button id="connect">Connect</button>
  <button id="send">Send</button>
  <button id="clear">Clear</button>
  <button id="disconnect">Disconnect</button>

  <div id="log" style="margin-top:20px; border:1px solid #ccc; padding:10px; width:400px; height:200px; overflow:auto;">
  </div>

  <script>
    let ws;

    document.getElementById('connect').onclick = () => {
      const userId = document.getElementById('user_id').value;
      const token = document.getElementById('token').value;

      ws = new WebSocket(`ws://localhost:8080/ws?user_id=${userId}&token=${token}`);

      ws.onopen = () => log('Connected');
      ws.onmessage = (event) => log('Received: ' + event.data);
      ws.onclose = (event) => log('Disconnected: ' + event.code + ' ' + event.reason);
      ws.onerror = () => log('WebSocket error.');
    };

    document.getElementById('clear').onclick = () => {
      const logDiv = document.getElementById('log');
      logDiv.innerHTML = ''
    }

    document.getElementById('send').onclick = () => {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        alert('WebSocket not connected');
        return;
      }
      const to = document.getElementById('to').value;
      const message = document.getElementById('message').value;

      const payload = JSON.stringify({ to, message });
      ws.send(payload);
    };

    document.getElementById('disconnect').onclick = () => {
      ws.close(1000, "Client closing connection");
    }

    function log(msg) {
      const logDiv = document.getElementById('log');
      logDiv.innerHTML += msg + '<br>';
      logDiv.scrollTop = logDiv.scrollHeight;
    }
  </script>
</body>

</html>